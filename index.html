<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FOR ABRAR & JANU üíñ</title>
<style>
body { background-color: #1a1a1a; color: #FF69B4; font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; cursor: url('https://img.icons8.com/color/32/hello-kitty.png'), auto; }

.cursor-glitter { position: fixed; width: 8px; height: 8px; background: gold; border-radius: 50%; pointer-events: none; animation: cursorGlitterFade 0.8s ease-out forwards; z-index: 9998; }
@keyframes cursorGlitterFade { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.3) translateY(20px); } }

#landing-page, #main-content, #sabala-sim { display: none; text-align: center; min-height: 100vh; width: 100%; }
#landing-page { display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
#main-content { padding: 50px 0; }

.menagerie { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin: 40px auto; max-width: 1200px; }
.animal-box { background: white; padding: 15px; border-radius: 25px; box-shadow: 8px 8px 0px #FF69B4; width: 200px; min-height: 280px; display: flex; flex-direction: column; align-items: center; justify-content: space-between; transition: 0.5s; overflow: hidden; }
.animal-img { width: 140px; height: 140px; object-fit: contain; cursor: pointer; transition: transform 0.2s, filter 0.3s; }
.game-text { font-size: 0.8rem; color: #555; margin: 5px 0; font-weight: bold; }
button.game-btn { background: #FF69B4; color: white; border: none; padding: 10px; border-radius: 10px; cursor: pointer; font-weight: bold; }

#sabala-sim { background-color: #2ecc71; cursor: none; position: relative; overflow: hidden; }
#score-board { font-size: 30px; color: white; padding: 20px; font-weight: bold; text-shadow: 2px 2px #000; }
#sabala-container { position: absolute; bottom: 20px; transform: translateX(-50%); pointer-events: none; display: flex; flex-direction: column; align-items: center; }
#nametag { background: white; color: #FF69B4; padding: 2px 10px; border-radius: 10px; font-weight: bold; font-size: 14px; margin-bottom: 5px; box-shadow: 2px 2px 0px #000; }
#sabala-player { font-size: 60px; line-height: 1; }
.banana { position: absolute; font-size: 40px; user-select: none; z-index: 10; cursor: pointer; }

#death-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #FFD1DC; z-index: 9999; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
.ayooz-title { color: #FF1493; font-size: 5rem; margin: 0; text-shadow: 4px 4px 0px white; }
.lee-gif { width: 160px; height: 160px; margin: 10px; border-radius: 15px; border: 4px solid white; object-fit: cover; }

.glitter { position: absolute; width: 10px; height: 10px; background: gold; border-radius: 50%; pointer-events: none; animation: fall 3s linear forwards; z-index: 10000; }
@keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }

#final-boss-btn { display: inline-block; background: linear-gradient(45deg, #ffd700, #ff69b4); border: 5px solid white; padding: 20px 50px; font-size: 28px; border-radius: 50px; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 0 30px gold; margin-top: 30px; animation: buttonPop 0.5s infinite alternate; }
@keyframes buttonPop { from { transform: scale(1); } to { transform: scale(1.05); } }
</style>
</head>
<body>

<div id="death-screen">
    <div id="gif-container" style="display:flex; justify-content:center;"></div>
    <h1 id="death-title" class="ayooz-title">Yal 3ayooooz</h1>
    <p style="font-size: 2rem; color: #555; font-weight: bold;">Score: <span id="final-score">0</span></p>
    <div style="display:flex; gap: 10px;">
        <button class="game-btn" id="retry-btn">RETRY üîÑ</button>
        <button class="game-btn" style="background: #555;" id="clear-btn">RESET BEST üóëÔ∏è</button>
    </div>
    <button class="game-btn" style="margin-top:20px; background: white; color: #FF69B4;" onclick="location.reload()">MAIN MENU</button>
</div>

<div id="landing-page" style="display:flex;">
    <h1>‚ö†Ô∏è CAUTION ‚ö†Ô∏è</h1>
    <p style="color:white;font-weight:bold;">DO NOT TOUCH THE PINK BUTTON.</p>
    <button id="forbidden-button" style="background-color:#FF69B4;color:white;border:4px solid white;padding:20px 40px;font-size:24px;border-radius:50px;cursor:pointer;font-weight:bold;">CLICK ME</button>
</div>

<div id="main-content">
    <h1>Happy Birthday, Abrar! üéÄ</h1>
    <div class="menagerie">
        <div class="animal-box">
            <div class="label">The Squish</div>
            <img src="seal.png" class="animal-img" id="seal-img">
            <p id="seal-game" class="game-text">Pets: 0</p>
        </div>
        <div class="animal-box">
            <div class="label">The Chaos Bun</div>
            <img src="bunny.png" class="animal-img" id="bun-img">
            <p id="bun-game" class="game-text">Hungry...</p>
            <button class="game-btn" id="bun-btn">FEED CARROT ü•ï</button>
        </div>
        <div class="animal-box">
            <div class="label">The Goblino</div>
            <img src="sphynx.png" class="animal-img" id="cat-img">
            <p id="cat-game" class="game-text">Temp: 20¬∞C</p>
            <button class="game-btn" id="cat-btn">TURN ON HEATER üî•</button>
        </div>
        <div class="animal-box">
            <div class="label">Janu</div>
            <img src="janu.png" class="animal-img" id="janu-img">
            <p id="janu-game" class="game-text">Janu is watching.</p>
            <button class="game-btn" id="janu-btn">SAY HELLO</button>
        </div>
    </div>
    <button id="final-boss-btn">ENTER SABALA SIMULATOR (enti)</button>
</div>

<div id="sabala-sim">
    <div id="score-board">Bananas: 0 | High Score: <span id="high-score-val">0</span></div>
    <div id="sabala-container">
        <div id="nametag">Abrar</div>
        <div id="sabala-player">üêí</div>
    </div>
</div>

<div id="janu-scare" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:2000;background:black;padding:10px;border:5px solid #FF69B4;border-radius:20px;">
    <iframe id="scare-video" width="315" height="560" src="" frameborder="0"></iframe><br>
    <button class="game-btn" onclick="closeScare()">SORRY JANU üò≠</button>
</div>

<script>
// --- BUTTON ---
const fBtn = document.getElementById("forbidden-button");
let escapes = 0;
fBtn.addEventListener("mouseover", () => {
    if(escapes<6){ 
        fBtn.style.position="absolute"; 
        fBtn.style.left=Math.random()*(window.innerWidth-200)+"px"; 
        fBtn.style.top=Math.random()*(window.innerHeight-100)+"px"; 
        escapes++; 
    }
});
fBtn.addEventListener("click", () => { 
    document.getElementById("landing-page").style.display="none"; 
    document.getElementById("main-content").style.display="block"; 
    document.body.style.backgroundColor="#FFD1DC"; 
});

// --- PETS ---
let pCount=0, bClicks=0, cTemp=20, jClicks=0;

document.getElementById("seal-img").addEventListener("click", function() {
    pCount++; 
    let msg = "Pets: " + pCount;
    
    if(pCount === 10) {
        msg = "ü•∞ So cute and squishy! ü•∞";
        alert("ü•∞ So cute and squishy! ü•∞");
    } else if(pCount === 20) {
        msg = "Shfeech mb 9aya? üòÖ";
        alert("Shfeech mb 9aya? üòÖ");
    }
    
    document.getElementById("seal-game").innerText = msg;
});

document.getElementById("bun-btn").addEventListener("click", function() {
    bClicks++; 
    document.getElementById("bun-img").style.transform=`scale(${1+bClicks*0.45})`; 
});

document.getElementById("cat-btn").addEventListener("click", function() {
    cTemp += 5; 
    let msg = "Temp: " + cTemp + "¬∞C";
    
    if(cTemp > 65) {
        document.getElementById("cat-img").src="sphynx_black.png";
        msg = "7aragteeee üî•üò±";
        alert("7aragteeee üî•üò±");
    }
    
    document.getElementById("cat-game").innerText = msg;
});

document.getElementById("janu-btn").addEventListener("click", function() {
    jClicks++; 
    if(jClicks <= 5) {
        const phrases = ["Whatcha doin?", "Pretty girl!", "I love Abrar!", "Muah!", "Peek-a-boo!"]; 
        document.getElementById("janu-game").innerText = "Janu says: " + phrases[Math.floor(Math.random()*phrases.length)];
    } else { 
        document.getElementById("scare-video").src = "https://www.youtube.com/embed/ix3rE46lWsU?autoplay=1"; 
        document.getElementById("janu-scare").style.display = "block"; 
    } 
});

function closeScare(){ 
    document.getElementById("scare-video").src = ""; 
    document.getElementById("janu-scare").style.display = "none"; 
    jClicks = 0; 
    document.getElementById("janu-game").innerText = "Janu is watching."; 
}

// --- SABALA GAME ---
let isSabalaActive = false;
let score = 0;
let highscore = parseInt(localStorage.getItem("sabalaHigh")) || 0;
document.getElementById("high-score-val").innerText = highscore;
let bananaSpawnTimeouts = [];
let gameStartTime = 0;
let activeBananas = new Set();
let isTransitioning = false; // Prevent multiple end-game triggers

document.getElementById("final-boss-btn").addEventListener("click", function() {
    document.getElementById("main-content").style.display = "none"; 
    document.getElementById("sabala-sim").style.display = "block"; 
    resetSabala();
});

function spawnBanana(){
    if(!isSabalaActive) return;
    
    const b = document.createElement("div"); 
    b.className = "banana"; 
    b.innerHTML = "üçå";
    b.style.left = Math.random()*(window.innerWidth-50) + "px"; 
    b.style.top = "-50px";
    document.getElementById("sabala-sim").appendChild(b);
    activeBananas.add(b);

    // Progressive difficulty: speed increases over time
    const timeElapsed = (Date.now() - gameStartTime) / 1000; // seconds
    const baseSpeed = 3.5;
    const speedIncrease = Math.min(timeElapsed * 0.18, 5); // Caps at +5 after ~28 seconds
    let fallSpeed = baseSpeed + speedIncrease;
    
    const fallInterval = setInterval(() => {
        if(!isSabalaActive){ 
            clearInterval(fallInterval); 
            if(b.parentNode) b.remove(); 
            return; 
        }
        
        let topPos = parseInt(b.style.top);
        b.style.top = (topPos + fallSpeed) + "px";

        let bRect = b.getBoundingClientRect();
        let pRect = document.getElementById("sabala-player").getBoundingClientRect();

        // Collision detection
        if(bRect.bottom > pRect.top && bRect.top < pRect.bottom && 
           bRect.left < pRect.right && bRect.right > pRect.left){
            score++;
            
            // Check for win condition BEFORE updating display (beat previous highscore)
            if(!isTransitioning && highscore > 0 && score > highscore) {
                isTransitioning = true;
                clearInterval(fallInterval);
                activeBananas.delete(b);
                if(b.parentNode) b.remove();
                // Delay slightly to ensure all intervals are cleared
                setTimeout(() => triggerVictory(), 100);
                return;
            }
            
            document.getElementById("score-board").innerHTML = `Bananas: ${score} | High Score: ${highscore}`;
            clearInterval(fallInterval); 
            activeBananas.delete(b);
            if(b.parentNode) b.remove();
            return;
        }

        // Banana missed - game over
        if(topPos > window.innerHeight){ 
            if(!isTransitioning) {
                isTransitioning = true;
                clearInterval(fallInterval); 
                activeBananas.delete(b);
                if(b.parentNode) b.remove(); 
                // Delay slightly to ensure all intervals are cleared
                setTimeout(() => triggerGameOver(), 100);
            }
        }
    }, 30);
}

function scheduleBananaSpawns(){
    if(!isSabalaActive) return;
    
    const timeElapsed = (Date.now() - gameStartTime) / 1000;
    
    // Dynamic spawn rate: start with 1 banana, gradually increase
    let maxConcurrent = 1;
    if(timeElapsed > 10) maxConcurrent = 2;
    if(timeElapsed > 25) maxConcurrent = 3;
    if(timeElapsed > 45) maxConcurrent = 4;
    
    // Spawn bananas if under the limit
    const currentCount = activeBananas.size;
    if(currentCount < maxConcurrent) {
        spawnBanana();
    }
    
    // Schedule next check - faster as game progresses
    const checkDelay = 400 + Math.random() * 300; // 400-700ms
    const timeout = setTimeout(() => scheduleBananaSpawns(), checkDelay);
    bananaSpawnTimeouts.push(timeout);
}

function triggerVictory(){
    if(!isSabalaActive) return;
    
    console.log("Victory triggered! Score:", score, "Highscore:", highscore);
    isSabalaActive = false; 
    
    // Clear any pending spawns
    bananaSpawnTimeouts.forEach(timeout => clearTimeout(timeout));
    bananaSpawnTimeouts = [];
    
    // Remove all bananas
    document.querySelectorAll("#sabala-sim .banana").forEach(b => b.remove());
    activeBananas.clear();
    
    // Update high score
    if(score > highscore){
        highscore = score;
        localStorage.setItem("sabalaHigh", highscore);
        document.getElementById("high-score-val").innerText = highscore;
    }
    
    document.getElementById("sabala-sim").style.display = "none";
    document.getElementById("death-screen").style.display = "flex";
    document.getElementById("death-screen").style.background = "linear-gradient(45deg, #FFD700, #FF69B4, #00FFFF)";
    document.getElementById("final-score").innerText = score;

    const title = document.getElementById("death-title");
    const gifBox = document.getElementById("gif-container"); 
    gifBox.innerHTML = "";

    title.innerText = "üéâ YOU WON! SABALA! üéâ";
    gifBox.innerHTML = '<img src="lee_dance.gif" class="lee-gif"><img src="lee_yes.gif" class="lee-gif">';
    
    // Trigger glitter effect
    createGlitter();
}

function triggerGameOver(){
    if(!isSabalaActive) return;
    
    console.log("Game Over triggered! Score:", score, "Highscore:", highscore);
    isSabalaActive = false; 
    
    // Clear any pending spawns
    bananaSpawnTimeouts.forEach(timeout => clearTimeout(timeout));
    bananaSpawnTimeouts = [];
    
    // Remove all bananas
    document.querySelectorAll("#sabala-sim .banana").forEach(b => b.remove());
    activeBananas.clear();
    
    document.getElementById("sabala-sim").style.display = "none";
    document.getElementById("death-screen").style.display = "flex";
    document.getElementById("death-screen").style.background = "#FFD1DC";
    document.getElementById("final-score").innerText = score;

    const title = document.getElementById("death-title");
    const gifBox = document.getElementById("gif-container"); 
    gifBox.innerHTML = "";

    if(score > highscore){
        highscore = score;
        localStorage.setItem("sabalaHigh", highscore);
        document.getElementById("high-score-val").innerText = highscore;
        title.innerText = "üéâ New Record! üéâ";
        gifBox.innerHTML = '<img src="lee_dance.gif" class="lee-gif"><img src="lee_yes.gif" class="lee-gif">';
    } else {
        title.innerText = "Yal 3ayooooz";
        gifBox.innerHTML = '<img src="lee_crazy.gif" class="lee-gif">';
    }
}

function createGlitter(){
    for(let i = 0; i < 100; i++){
        setTimeout(() => {
            const glitter = document.createElement("div");
            glitter.className = "glitter";
            glitter.style.left = Math.random() * 100 + "%";
            glitter.style.top = "-10px";
            glitter.style.background = ["gold", "#FF69B4", "#00FFFF", "#FFD700", "white"][Math.floor(Math.random()*5)];
            glitter.style.animationDelay = Math.random() * 0.5 + "s";
            glitter.style.animationDuration = (Math.random() * 2 + 2) + "s";
            document.getElementById("death-screen").appendChild(glitter);
            
            setTimeout(() => glitter.remove(), 3500);
        }, i * 30);
    }
}

function resetSabala(){
    console.log("Resetting game...");
    
    // Clear everything first
    bananaSpawnTimeouts.forEach(timeout => clearTimeout(timeout));
    bananaSpawnTimeouts = [];
    
    // Remove all existing bananas
    document.querySelectorAll("#sabala-sim .banana").forEach(b => b.remove());
    activeBananas.clear();
    
    score = 0; 
    gameStartTime = Date.now();
    isSabalaActive = true;
    isTransitioning = false; // Reset transition flag
    document.getElementById("score-board").innerHTML = `Bananas: 0 | High Score: ${highscore}`;
    document.getElementById("sabala-container").style.left = "50%";
    
    console.log("Game reset complete. Starting spawns...");
    // Start the spawn scheduler
    setTimeout(() => scheduleBananaSpawns(), 500);
}

// Retry button
document.getElementById("retry-btn").addEventListener("click", function() {
    console.log("Retry clicked!");
    document.getElementById("death-screen").style.display = "none";
    document.getElementById("sabala-sim").style.display = "block";
    resetSabala();
});

// Clear high score button
document.getElementById("clear-btn").addEventListener("click", function() {
    localStorage.setItem("sabalaHigh", 0); 
    highscore = 0; 
    document.getElementById("high-score-val").innerText = 0; 
    alert("Record wiped!"); 
});

// MONKEY FOLLOW MOUSE with cursor glitter (Sabala game only)
let lastGlitterTime = 0;
window.addEventListener("mousemove", e => {
    // Global cursor glitter trail
    const now = Date.now();
    if(now - lastGlitterTime > 50) {
        lastGlitterTime = now;
        const glitter = document.createElement("div");
        glitter.className = "cursor-glitter";
        glitter.style.left = e.pageX + "px";
        glitter.style.top = e.pageY + "px";
        glitter.style.background = ["gold", "#FF69B4", "#00FFFF", "#FFD700", "white"][Math.floor(Math.random()*5)];
        document.body.appendChild(glitter);
        
        setTimeout(() => glitter.remove(), 800);
    }
    
    // Sabala game-specific: move the monkey
    if(!isSabalaActive) return;
    const container = document.getElementById("sabala-container");
    let x = e.pageX; 
    if(x < 50) x = 50; 
    if(x > window.innerWidth - 50) x = window.innerWidth - 50;
    container.style.left = x + "px";
});
</script>
</body>
</html>
